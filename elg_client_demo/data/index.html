<!DOCTYPE html>
<head>
	<link rel="stylesheet" href="resources/picnic.min.css"></link>
	<link rel="stylesheet" href="resources/plugins.min.css"></link>
	<link rel="stylesheet" href="resources/animate.min.css"></link>
	<script src="resources/umbrella.min.js"></script>
	<!-- for ssid tables -->
	<style>
		.hidden {
		    display: none;
		}
		button{
			background:#0e4d95;
		}
		.button{
			background:#0e4d95;
		}
	</style>
	<!-- toggle switch -->
	<style>
		.switch {
		  position: relative;
		  display: inline-block;
		  width: 60px;
		  height: 34px;
		}

		.switch input {display:none;}

		.slider {
		  position: absolute;
		  cursor: pointer;
		  top: 0;
		  left: 0;
		  right: 0;
		  bottom: 0;
		  background-color: #ccc;
		  -webkit-transition: .4s;
		  transition: .4s;
		}

		.slider:before {
		  position: absolute;
		  content: "";
		  height: 26px;
		  width: 26px;
		  left: 4px;
		  bottom: 4px;
		  background-color: white;
		  -webkit-transition: .4s;
		  transition: .4s;
		}

		input:checked + .slider {
		  background-color: #0e4d95;
		}

		input:focus + .slider {
		}

		input:checked + .slider:before {
		  -webkit-transform: translateX(26px);
		  -ms-transform: translateX(26px);
		  transform: translateX(26px);
		}
		</style>
	<!-- loading animation -->
  <style type="text/css">
	    /*
	 *  Usage:
	 *
	      <div class="sk-wave">
	        <div class="sk-rect sk-rect1"></div>
	        <div class="sk-rect sk-rect2"></div>
	        <div class="sk-rect sk-rect3"></div>
	        <div class="sk-rect sk-rect4"></div>
	        <div class="sk-rect sk-rect5"></div>
	      </div>
	 *
	 */
	.sk-wave {
	  margin: 40px auto;
	  width: 50px;
	  height: 40px;
	  text-align: center;
	  font-size: 10px; }
	  .sk-wave .sk-rect {
	    background-color: #0e4d95;
	    height: 100%;
	    width: 6px;
	    display: inline-block;
	    -webkit-animation: sk-waveStretchDelay 1.2s infinite ease-in-out;
	            animation: sk-waveStretchDelay 1.2s infinite ease-in-out; }
	  .sk-wave .sk-rect1 {
	    -webkit-animation-delay: -1.2s;
	            animation-delay: -1.2s; }
	  .sk-wave .sk-rect2 {
	    -webkit-animation-delay: -1.1s;
	            animation-delay: -1.1s; }
	  .sk-wave .sk-rect3 {
	    -webkit-animation-delay: -1s;
	            animation-delay: -1s; }
	  .sk-wave .sk-rect4 {
	    -webkit-animation-delay: -0.9s;
	            animation-delay: -0.9s; }
	  .sk-wave .sk-rect5 {
	    -webkit-animation-delay: -0.8s;
	            animation-delay: -0.8s; }
	@-webkit-keyframes sk-waveStretchDelay {
	  0%, 40%, 100% {
	    -webkit-transform: scaleY(0.4);
	            transform: scaleY(0.4); }
	  20% {
	    -webkit-transform: scaleY(1);
	            transform: scaleY(1); } }
	@keyframes sk-waveStretchDelay {
	  0%, 40%, 100% {
	    -webkit-transform: scaleY(0.4);
	            transform: scaleY(0.4); }
	  20% {
	    -webkit-transform: scaleY(1);
	            transform: scaleY(1); } }
	</style>
</head>

<nav class="loading" style="background-color: #0e4d95;"><a href="/" class="brand" style="background:url('resources/skyhook_logo.svg') center no-repeat; color:transparent;height: 50px;width:160px; margin-left:20px"><span>Logo</span></a></nav>

<main>
	<div class="tabs three" style="text-align:center; width:90%; max-width:960px; padding-top: 80px; margin:auto;">
  <input id='tab-1' type='radio' name='tabgroupB' checked />
  <label class="pseudo button toggle" for="tab-1">Current Network</label>
  <input id='tab-2' type='radio' name='tabgroupB'>
  <label class="pseudo button toggle" for="tab-2">Network Scan</label>
  <input id='tab-3' type='radio' name='tabgroupB'>
  <label class="pseudo button toggle" for="tab-3">Systems Panel</label>
  <div class="row">
    <div>
      <div class="sk-wave hidden" for="current">
	        <div class="sk-rect sk-rect1"></div>
	        <div class="sk-rect sk-rect2"></div>
	        <div class="sk-rect sk-rect3"></div>
	        <div class="sk-rect sk-rect4"></div>
	        <div class="sk-rect sk-rect5"></div>
	      </div>
    </div>

    <div>
    <br>
    	<a class="special button" style>Scan for Networks</a>
	      <div class="sk-wave hidden" for="network">
	        <div class="sk-rect sk-rect1"></div>
	        <div class="sk-rect sk-rect2"></div>
	        <div class="sk-rect sk-rect3"></div>
	        <div class="sk-rect sk-rect4"></div>
	        <div class="sk-rect sk-rect5"></div>
	      </div>
      <section class="aps flex one center" style="text-align:left; width:90%; max-width:960px; margin:auto;">
			</section>
    </div>

    <div>
    	<div class='flex three center'>
	    	<article class="card">
	    		<header>
	    				<span>NAP</span>
	    		</header>
	    		<footer>
	    			<div class="flex two center">
							<div style="text-align:center">
								<label class="switch">
								  <input class="toggle" data-wut="hehe" type="checkbox">
								  <div class="slider"></div>
								</label>
							</div>
						</div>
					</footer>
				</article>
				<article class="card">
  				<header><span>Reverse Geo</span></header>
  				<footer>
  					<div>
	    					<div style="text-align:center">
									<label class="switch">
									  <input class="toggle" data-wut="hehe" type="checkbox">
									  <div class="slider"></div>
									</label>
								</div>
							</div>
  				</footer>
				</article>
			</div>
			<div class='flex two center'>
				<article class="card">
					<header>
						<span> Scan Frequency </span>
					</header>
					<footer>
						<div>
							<label><input type="number" placeholder="ms" min="200"></label>
						</div>
					</footer>
				</article>
			</div>
    </div>
  </div>
</main>
<div class="modal">
  <input id="modal_1" type="checkbox" />
  <label class="overlay"></label>
  <article>
    <header>
      <h3>Enter the Wifi Password</h3>
      <label for="modal_1" class="close">&times;</label>
    </header>
    <section class="content">
    	<span class="hidden warning button stack error">AP is on a different channel! You may be disconnect while connecting...</span>
      <input type="password" placeholder="Password" />
    </section>
    <footer>
      <label class="button changeap">
        Connect
      </label>
    </footer>
  </article>
</div>
<script>
	var selected_network = "";
	var getWifiDisplayTemplate = function(ssid, bssid, rssi, encryption_type, channel, hidden){
		return "<article class='stack animated fadeInDown card'><header class='show'><div class='flex two'><div>"+ssid+"</div><div>"+rssi+"</div></div></header><article class='hidden card'><footer><div class='testing flex full'><div class='two-fifth'>E:"+encryption_type+"<br>B:"+bssid+"<br>C:"+channel+"<br>H:"+hidden+"<br></div><div class='two-fifth'>chart</div><div class='fifth'><label for='modal_1' class='button connectap' style='position: absolute; bottom: .8em; right: .8em;' data-ssid='"+ssid+"''>Connect</label></div></div></footer></article></article>"
	};
	var scan = function(){
		console.log('scanning');
  	var action = 'skyhookclient/scan';
		var after = function(err, data){
			console.log("attempting to remove class")
			Object.keys(data).forEach(function(key) {
		    	var network_item = data[key];
		    	// console.log(getWifiDisplayTemplate(key,network_item["bssid"], network_item["rssi"], network_item["encrypt"], network_item["channel"], network_item["hidden"]));
		    	u('.aps').append(getWifiDisplayTemplate(key,network_item["bssid"], network_item["rssi"], network_item["encrypt"], network_item["channel"], network_item["hidden"]));
			});
			u('.sk-wave[for=network]').addClass('hidden');
			reset();
		}
		var before = function(xhr){
			xhr.responseType = 'json';
			u('.sk-wave[for=network]').removeClass('hidden')
		};
		ajax(action, {method:'GET'}, after, before);
	};
	var reset = function(){
		console.log('reseting')
		u('.show').off('click');
		u('.connectap').off('click');
		u('.show').on('click', function(e) {
  			u(this).siblings('article').toggleClass('hidden')
  			console.log("show is clicking")
		});
		u('.connectap').on('click', function(e){
			console.log('show modal clicked')
			console.log(u(this).data('ssid'))
			selected_network = u(this).data('ssid');
			// TODO: Check if current channel and AP channel are different, if yes toggle warning
		});
	};
	var getCurrentNetwork = function(){
		var action = 'skyhookclient/getstatus';
		var after = function(err, data){
			console.log(data);
			u('.sk-wave[for="current"]').addClass('hidden')
		}
		var before = function(xhr){
			xhr.responseType = 'json';
			u('.sk-wave[for="current"]').removeClass('hidden')
		};
		ajax(action, {method:'GET'}, after, before);
	};
	var connect_to_ap = function(ssid_input, password_input){
		var action = 'skyhookclient/changeap';
		var options = {method: 'POST', body: {ssid:ssid_input, password: password_input}};
		var after = function(err, data){
			console.log(data);
			window.setTimeout(function () {
        location.href = "/";
    	}, 8000);
		}
		var before = function(xhr){
			console.log("Attempting to connect to:"+ssid_input+" with password: "+password_input)
			xhr.responseType = 'json';
		};
		ajax(action, options, after, before);
	};
 	u('.special').on('click', function(e){
 		console.log('button click');
		u('.aps').children().remove();
 		scan();
	});
	u('.pseudo, .button, .toggle').on('click',function(){
		if(u(this).attr('for')=='tab-1'){
			console.log('tab 1');
			getCurrentNetwork();
		}
		else if(u(this).attr('for')=='tab-2'){
			if(u('.aps').children().length == 0){
				console.log("tab-2 clicked")
				console.log("initial scan")
				scan();
			}
		}
		else if(u(this).attr('for')=='tab-3'){
			console.log('tab-3 clicked');
		}
	});
	if(u('#tab-1').is(':checked')){
		console.log('getting inital network status');
		getCurrentNetwork();
	}
	u('.changeap').on('click', function(){
		console.log("changeap button clicked");
		connect_to_ap(selected_network, u('.changeap').closest('article').find('input').nodes[0].value);
	});
	u('.toggle').on('click', function() {

    // if (u('.toggle').is(':checked')) {
    //     console.log('checked');
    // }
    // else {
    //     // code
    // }
    u('.toggle:checked').each(function(){console.log('hi')})
})
</script>
</html>